{% extends "template.html" %}
{% block title %}{{ party['party_name'] }} - WTM Harvard{% endblock %}
{% block content %}
<div class="container">
    <div class="party-detail-header">
        <div>
            <p class="eyebrow">Party detail</p>
            <h1>{{ party['party_name'] }}</h1>
            <p class="party-meta">
                Hosted by {{ party['verified_host'] }}
                <span class="verified-badge">âœ“ Verified</span>
            </p>
        </div>
        <a class="btn ghost" href="/list">Back to list</a>
    </div>
    
    <!-- Add image/flyer to the party -->
    {% if party.flyer_path %}
    <div class="party-detail-card" style="margin-top: 16px;">
        <img src="{{ url_for('static', filename=party.flyer_path) }}" 
             alt="{{ party.party_name }} flyer"
             style="max-width: 100%; max-height: 400px; object-fit: cover; border-radius: 8px; display: block; margin: 0 auto;">
    </div>
    {% endif %}
    
    <div class="party-detail-grid">
        <div class="party-detail-card">
            <h3>When</h3>
            <p>{{ party['date'] }} at {{ party['time'] }}</p>
        </div>
        <div class="party-detail-card">
            <h3>Where</h3>
            <p>{{ party['location'] }}</p>
        </div>
        <div class="party-detail-card">
            <h3>Posted</h3>
            <p>{{ party['created_at'] }}</p>
        </div>
    </div>
    
    <!-- Create an interactive map -->
    {% if party.latitude and party.longitude %}
    <div class="party-detail-card" style="margin-top: 16px;">
        <h3>Location on Map</h3>
        <div id="partyMap" 
             data-lat="{{ party.latitude }}" 
             data-lng="{{ party.longitude }}"
             data-party-name="{{ party.party_name }}"
             data-location="{{ party.location }}"
             style="height: 300px; width: 100%; border-radius: 8px; margin-top: 12px;"></div>
    </div>
    {% endif %}
    
    <div class="party-detail-card" style="margin-top: 16px;">
        <h3>Description</h3>
        <p>{% if party['description'] %}{{ party['description'] }}{% else %}No description provided.{% endif %}</p>
    </div>
    
    <!-- Security clearance for party creation -->
    <div class="auth-callout" style="margin-top: 16px;">
        <div>
            <p class="eyebrow">Security verified</p>
            <p class="small" style="margin-top: 6px;">
                This party was created by a verified user. The host name "{{ party['host_name'] }}" matches the verified username "{{ party['verified_host'] }}".
            </p>
        </div>
    </div>
    
    <!-- Add or delete party -->
    {% if session.get('user_id') == party['user_id'] %}
    <div class="party-actions" style="margin-top: 20px; display: flex; gap: 12px;">
        <a href="{{ url_for('edit_party', party_id=party['id']) }}" class="btn primary">Edit Party</a>
        <form action="{{ url_for('delete_party', party_id=party['id']) }}" method="POST" 
              onsubmit="return confirm('Are you sure you want to delete this party?');" style="display: inline;">
            <button type="submit" class="btn ghost" style="border-color: #dc3545; color: #dc3545;">Delete Party</button>
        </form>
    </div>
    {% endif %}
</div>

{% if party.latitude and party.longitude %}
<!-- CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<!-- JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='party_detail.js') }}"></script>
{% endif %}
{% endblock %}